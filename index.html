<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Collatz Racing</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
  50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.8); }
}
.pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }

@keyframes slide-in {
  from { transform: translateY(-20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
.slide-in { animation: slide-in 0.5s ease-out; }

@keyframes bounce-in {
  0% { transform: scale(0.8); opacity: 0; }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); opacity: 1; }
}
.bounce-in { animation: bounce-in 0.5s ease-out; }

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}
.fade-in { animation: fade-in 0.3s ease-out; }
</style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
<div class="container mx-auto px-4 py-8 max-w-4xl">

  <!-- Login Screen -->
  <div id="loginScreen" class="bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center border border-white/20">
    <div class="text-6xl mb-4">ğŸ”</div>
    <h2 class="text-3xl font-bold mb-4">Sign in to Play</h2>
    <p class="text-gray-300 mb-6">Sign in with Google to challenge friends and track your rating.</p>
    <button id="loginBtn"
      class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 pulse-glow text-xl">
      Sign in with Google
    </button>
  </div>

  <!-- Lobby Screen -->
  <div id="lobbyScreen" class="hidden space-y-6">
    <!-- Header Card -->
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 text-center">
      <h2 class="text-3xl font-bold mb-2">Collatz Racing Lobby</h2>
      <p class="text-sm text-gray-400" id="userInfoDisplay"></p>
      <div id="ratingDisplay" class="mt-2"></div>
      <div id="rdDisplay" class="mt-1 text-sm"></div>
      <div class="mt-3 bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 max-w-md mx-auto">
        <p class="text-xs text-gray-300 leading-relaxed">
          <span class="font-semibold text-blue-400">Rating Deviation (RD):</span> Lower RD means your rating is more stable. Above 110 is provisional. To be ranked, your RD must be under 85.
        </p>
      </div>
    </div>
    
    <!-- Toggle Buttons -->
    <div class="flex gap-3 justify-center">
      <button id="toggleLeaderboardBtn" 
        class="bg-white/5 hover:bg-white/10 text-white font-semibold py-2 px-6 rounded-lg transition-all border border-white/20">
        ğŸ† Show Leaderboard
      </button>
      <button id="toggleLobbyListBtn" 
        class="bg-white/5 hover:bg-white/10 text-white font-semibold py-2 px-6 rounded-lg transition-all border border-white/20">
        ğŸ® Show Active Duels
      </button>
    </div>
    
    <!-- Leaderboard Container -->
    <div id="leaderboardContainer" class="hidden bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 fade-in">
      <h3 class="text-xl font-bold mb-3 text-center text-blue-400">ğŸ† Top Players</h3>
      <div id="leaderboard" class="space-y-2 max-h-64 overflow-y-auto">
        <p class="text-gray-400 text-sm text-center">Loading leaderboard...</p>
      </div>
    </div>
    
    <!-- Active Duels Container -->
    <div id="lobbyListContainer" class="hidden bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 fade-in">
      <h3 class="text-xl font-bold mb-3 text-center text-green-400">ğŸ® Active Duels</h3>
      <div id="lobbyList" class="space-y-2 max-h-64 overflow-y-auto">
        <p class="text-gray-400 text-sm text-center">Loading active duels...</p>
      </div>
    </div>
    
    <!-- Game Mode Selection -->
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 space-y-4">
      <!-- Rated/Casual Toggle -->
      <div class="flex items-center justify-center gap-3">
        <span class="text-sm text-gray-400">ğŸ® Casual</span>
        <label class="relative inline-flex items-center cursor-pointer">
          <input type="checkbox" id="ratedToggle" class="sr-only peer" checked>
          <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
        </label>
        <span class="text-sm font-semibold text-blue-400">â­ Rated</span>
      </div>
      
      <!-- Public/Private Toggle -->
      <div class="flex items-center justify-center gap-3">
        <span class="text-sm text-gray-400">ğŸ”’ Private</span>
        <label class="relative inline-flex items-center cursor-pointer">
          <input type="checkbox" id="publicToggle" class="sr-only peer" checked>
          <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
        </label>
        <span class="text-sm font-semibold text-green-400">ğŸŒ Public</span>
      </div>
      <p class="text-xs text-gray-400 text-center">Public games appear in Active Duels list</p>
    </div>
    
    <!-- Create/Join Duel -->
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 space-y-4">
      <button id="createDuelBtn" 
        class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 w-full">
        Create Duel
      </button>
      
      <div class="flex gap-2">
        <input type="text" id="duelCodeInput" placeholder="Enter Duel Code" 
          class="flex-1 px-4 py-3 rounded-lg text-black text-center font-mono uppercase tracking-wider"
          maxlength="6">
        <button id="joinDuelBtn" 
          class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105">
          Join Duel
        </button>
      </div>
      
      <p class="text-gray-300 text-center min-h-[24px]" id="lobbyStatus"></p>
    </div>
    
    <!-- Logout -->
    <div class="text-center">
      <button id="logoutBtn" class="text-sm text-red-400 hover:text-red-300 underline transition-colors">
        Sign out
      </button>
    </div>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen" class="hidden space-y-6">
    <!-- Game Mode Badge -->
    <div class="text-center">
      <span id="gameModeBadge" class="inline-block px-4 py-2 rounded-full text-sm font-semibold bg-blue-500/30 border border-blue-500/50">
        â­ Rated Game
      </span>
    </div>

    <!-- Player Stats -->
    <div class="grid grid-cols-2 gap-4">
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center border border-white/20">
        <p class="text-sm text-gray-400 mb-1">Your Number</p>
        <p class="text-3xl font-bold text-yellow-400" id="yourNumber"></p>
        <p class="text-sm text-gray-400 mt-1">Steps: <span id="yourSteps">0</span></p>
      </div>
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center border border-white/20">
        <p class="text-sm text-gray-400 mb-1">Opponent's Number</p>
        <div id="opponentNumberContainer" 
             class="cursor-pointer hover:bg-white/5 rounded-lg p-2 transition-all"
             title="Click and hold to reveal">
          <p class="text-3xl font-bold text-pink-400" id="opponentNumber">?</p>
          <p class="text-xs text-gray-500 mt-1" id="revealHint">ğŸ‘ï¸ Click to peek</p>
        </div>
        <p class="text-sm text-gray-400 mt-1">Steps: <span id="opponentSteps">0</span></p>
      </div>
    </div>

    <!-- Input Area -->
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 border border-white/20">
      <label class="block text-center text-lg font-semibold mb-4 text-gray-300">What's the next number?</label>
      <div class="flex gap-3">
        <input type="number" id="answerInput"
          class="flex-1 px-6 py-4 bg-white/20 border-2 border-blue-500/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white text-3xl text-center font-bold placeholder-gray-400"
          placeholder="?" autofocus>
        <button id="submitBtn"
          class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 text-xl">
          Submit
        </button>
      </div>
      <div id="feedback" class="mt-4 text-center text-lg font-semibold min-h-[28px]"></div>
      <div class="mt-2 text-center text-sm text-gray-400">Time: <span id="gameTimer">0.0s</span></div>
      
      <!-- Sequence Log -->
      <div class="mt-6 pt-4 border-t border-white/10">
        <p class="text-sm text-gray-400 mb-2 text-center">Your Sequence:</p>
        <div id="sequenceLog" class="flex flex-wrap gap-2 justify-center items-center"></div>
      </div>
    </div>
  </div>

  <!-- Result Screen -->
  <div id="resultScreen" class="hidden bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center border border-white/20 slide-in">
    <div class="text-8xl mb-6 bounce-in" id="resultEmoji"></div>
    <h2 class="text-4xl font-bold mb-4" id="resultTitle"></h2>
    <div id="forfeitMessage" class="text-red-400 text-sm mb-4"></div>
    
    <div class="bg-white/5 rounded-lg p-6 mb-6 max-w-md mx-auto">
      <div class="grid grid-cols-2 gap-4 text-left">
        <div>
          <p class="text-sm text-gray-400">Your Steps</p>
          <p class="text-2xl font-bold text-blue-400" id="finalSteps"></p>
        </div>
        <div>
          <p class="text-sm text-gray-400">Time</p>
          <p class="text-2xl font-bold text-purple-400" id="finalTime"></p>
        </div>
      </div>
      <div id="ratingChangeDisplay" class="mt-4"></div>
    </div>
    
    <button id="returnLobbyBtn"
      class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105">
      Return to Lobby
    </button>
  </div>
</div>

<script type="module" src="index.js"></script>
</body>
</html>
