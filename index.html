<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Collatz Duel Challenge</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* Animations */
@keyframes pulse-glow {0%,100%{box-shadow:0 0 20px rgba(59,130,246,0.5);}50%{box-shadow:0 0 40px rgba(59,130,246,0.8);}}
.pulse-glow{animation:pulse-glow 2s ease-in-out infinite;}
@keyframes slide-in{from{transform:translateY(-20px);opacity:0;}to{transform:translateY(0);opacity:1;}}
.slide-in{animation:slide-in 0.5s ease-out;}
@keyframes shake{0%,100%{transform:translateX(0);}10%,30%,50%,70%,90%{transform:translateX(-10px);}20%,40%,60%,80%{transform:translateX(10px);}}
.shake{animation:shake 0.5s ease-in-out;}
</style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
<div class="container mx-auto px-4 py-8 max-w-4xl">

  <!-- Login Screen -->
  <div id="loginScreen" class="bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center border border-white/20">
    <div class="text-6xl mb-4">üîê</div>
    <h2 class="text-3xl font-bold mb-4">Sign in to Play</h2>
    <p class="text-gray-300 mb-6">Sign in with Google to challenge friends and save scores.</p>
    <button id="loginBtn"
      class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 pulse-glow text-xl">
      Sign in with Google
    </button>
    <div id="userInfo" class="mt-4 text-gray-300 text-sm hidden"></div>
  </div>

  <!-- Lobby / Duel Screen -->
  <div id="duelLobby" class="hidden bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center border border-white/20 space-y-6">
    <h2 class="text-3xl font-bold mb-4">Collatz Duel Lobby</h2>
    <div>
      <button id="createDuelBtn" class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-3 px-6 rounded-lg mr-2">Create Duel</button>
      <input type="text" id="duelIDInput" placeholder="Enter Duel ID" class="px-4 py-2 rounded-lg text-black">
      <button id="joinDuelBtn" class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-3 px-6 rounded-lg ml-2">Join Duel</button>
    </div>
    <p class="text-gray-300 mt-4" id="duelStatus"></p>
    <button id="logoutBtn" class="text-sm text-red-400 underline">Sign out</button>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen" class="hidden space-y-6">
    <!-- Stats -->
    <div class="grid grid-cols-2 gap-4">
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center border border-white/20">
        <p class="text-sm text-gray-400 mb-1">Your Number</p>
        <p class="text-3xl font-bold text-yellow-400" id="currentNumber"></p>
        <p class="text-sm text-gray-400 mt-1">Steps: <span id="stepCount">0</span></p>
      </div>
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center border border-white/20">
        <p class="text-sm text-gray-400 mb-1">Opponent's Number</p>
        <p class="text-3xl font-bold text-pink-400" id="opponentNumber">?</p>
        <p class="text-sm text-gray-400 mt-1">Steps: <span id="opponentStepCount">0</span></p>
      </div>
    </div>

    <!-- Input -->
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 border border-white/20">
      <label class="block text-center text-lg font-semibold mb-4 text-gray-300">What's the next number?</label>
      <div class="flex gap-3">
        <input type="number" id="answerInput"
          class="flex-1 px-6 py-4 bg-white/20 border-2 border-blue-500/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white text-3xl text-center font-bold placeholder-gray-400"
          placeholder="?" autofocus>
        <button id="submitBtn"
          class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 text-xl">
          Submit
        </button>
      </div>
      <div id="feedback" class="mt-4 text-center text-lg font-semibold h-8"></div>
    </div>
  </div>

  <!-- Result Screen -->
  <div id="resultScreen" class="hidden bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center border border-white/20 slide-in">
    <div class="text-8xl mb-6" id="resultEmoji"></div>
    <h2 class="text-4xl font-bold mb-4" id="resultTitle"></h2>
    <div class="bg-white/5 rounded-lg p-6 mb-6 max-w-md mx-auto">
      <div class="grid grid-cols-2 gap-4 text-left">
        <div>
          <p class="text-sm text-gray-400">Your Steps</p>
          <p class="text-2xl font-bold text-blue-400" id="finalSteps"></p>
        </div>
        <div>
          <p class="text-sm text-gray-400">Time</p>
          <p class="text-2xl font-bold text-purple-400" id="finalTime"></p>
        </div>
      </div>
    </div>
    <button onclick="returnToLobby()"
      class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105">
      Return to Lobby
    </button>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
import { 
  getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { 
  getDatabase, ref, set, push, onValue, update 
} from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyB9oK73wo05B6YHViDTUsh2gT-04G4FpP8",
    authDomain: "collatz-racing.firebaseapp.com",
    databaseURL: "https://collatz-racing-default-rtdb.firebaseio.com", 
    projectId: "collatz-racing",
    storageBucket: "collatz-racing.firebasestorage.app",
    messagingSenderId: "78351409018",
    appId: "1:78351409018:web:ff8ecfd3e6018f896dc0c3",
    measurementId: "G-5J0FS12HGE"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const rtdb = getDatabase(app);

// Expose Firebase functions
window.firebaseAuth = auth;
window.firebaseProvider = provider;
window.firebaseSignInWithPopup = signInWithPopup;
window.firebaseSignOut = signOut;
window.firebaseOnAuthStateChanged = onAuthStateChanged;
window.firebaseRTDB = rtdb;
window.firebaseRTDBRef = ref;
window.firebaseRTDBSet = set;
window.firebaseRTDBPush = push;
window.firebaseRTDBOnValue = onValue;
window.firebaseRTDBUpdate = update;
</script>

<script src="index.js"></script>
</body>
</html>
